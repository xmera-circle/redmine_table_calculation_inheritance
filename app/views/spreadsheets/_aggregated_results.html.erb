<% if table.calculation_configs.present? %>
  <%= tag.p do %>
    <%= content_tag :table, class: 'list' do %>
      <%= content_tag :thead do %>
        <%= content_tag :tr do %>
          <% table.header.each do |column| %>
            <%= content_tag(:th, column.name, class: 'name', title: column.description) %>
          <% end %>
            <%= content_tag(:th, '') %>
        <% end %>
      <% end %>
      <%= content_tag :tbody do %>
        <% table.rows.each do |row| %> 
          <%= content_tag :tr do %>
            <% row.each do |cell| %>
              <%= content_tag(:td, format_table_value(cell.value, cell.custom_field), class: 'name', data: { color: cell.cast_color }) %>
            <% end %>
            <%= tag.td class: 'buttons' do %>
              <% if User.current.allowed_to?(:edit_spreadsheet_results, project) %> 
                  <% calculation_config_id = row.last.send(:row_index) %>
                  <% result_row = spreadsheet_result_rows.find_by(calculation_config_id: calculation_config_id ) %>
                  <% cfv = row.each_with_object({}) do |cell, hash|
                      if cell.custom_field
                        hash[cell.custom_field.id] = cell.value
                        hash
                      end
                     end
                  %>
                  <%= link_to l(:label_inherit),
                      result_row ? spreadsheet_row_result_path(id: result_row.id, calculation_config_id: calculation_config_id, cfv: cfv) : new_project_spreadsheet_spreadsheet_row_result_path(spreadsheet_id: @spreadsheet.id, calculation_config_id: calculation_config_id, spreadsheet_row_result: { custom_field_values: cfv }), 
                      method: result_row&.id.present? ? :patch : :get,
                      class: 'icon icon-checked',
                      title: l(:label_inherit) %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>